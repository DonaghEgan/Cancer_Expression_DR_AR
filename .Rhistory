seurat_score@meta.data <- seurat_score@meta.data %>%
mutate(
new_cell_type = dplyr::case_when(
seurat_score@meta.data$ratio > quantile(seurat_score@meta.data$ratio, 0.33) ~ "IFNG_RS",
seurat_score@meta.data$ratio < quantile(seurat_score@meta.data$ratio, 0.66) ~ "IFNG_GS",
TRUE ~ Malignant_clusters  # Keep other cell types unchanged
)
)
seurat_score@meta.data$response_ot <- paste(seurat_score@meta.data$Response, seurat_score@meta.data$Timepoint)
cell_type_proportions_all <- seurat_score@meta.data %>%
group_by(sample_ID, new_cell_type) %>%
plotly::summarise(Count = dplyr::n()) %>%
mutate(proportion = Count / sum(Count))
proportion_check <- cell_type_proportions_all %>%
group_by(sample_ID) %>%
dplyr::summarise(total_proportion = sum(proportion)) %>%
mutate(is_valid = dplyr::near(total_proportion, 1, tol = 1e-10))
# Aggregate metadata to retain unique sample-level information
seurat_aggregated <- seurat_score@meta.data %>%
group_by(sample_ID) %>%
summarise(across(everything(), first))  # Adjust the summarization logic as needed
prop_meta <- merge(cell_type_proportions_all, seurat_aggregated, by = "sample_ID",
all.x = T)
prop_meta_rs <- prop_meta[prop_meta$new_cell_type.x == "IFNG_RS",]
prop_meta_gs <- prop_meta[prop_meta$new_cell_type.x == "IFNG_GS",]
comp <- list(c("NonResponders BT", "NonResponders OT"),
c("Responders OT", "NonResponders OT"),
c("Responders BT", "NonResponders BT"),
c("Responders BT", "NonResponders OT"),
c("Responders BT", "Responders OT"))
# Example usage with proper parameters
p1 <- plot_boxplot(
prop_meta_rs,
x_var = "response_ot", # Must be quoted string
y_var = "proportion",
y_label = "Cell Population Proportions",
comparisons = comp,
color_pal = c("#4DBBD5FF","#4DBBD5FF","#E64B35FF","#E64B35FF"),
x_labels = c("NonResponders BT" = "NR BT", "NonResponders OT" = "NR OT",
"Responders BT" = "R BT", "Responders OT" = "R OT")
)  + ggtitle("Cells High IFNG.RS:IFNG.GS")
# Example usage with proper parameters
p2 <- plot_boxplot(
prop_meta_gs,
x_var = "response_ot", # Must be quoted string
y_var = "proportion",
y_label = "Cell Population Proportions",
comparisons = comp,
color_pal = c("#4DBBD5FF","#4DBBD5FF","#E64B35FF","#E64B35FF"),
x_labels = c("NonResponders BT" = "NR BT", "NonResponders OT" = "NR OT",
"Responders BT" = "R BT", "Responders OT" = "R OT")
) + ggtitle("Cells High IFNG_GS:IFNG.RS")
p1
p2
p1
p2
p1
p2
p1
p2
seurat_score@meta.data <- seurat_score@meta.data %>%
mutate(
new_cell_type = dplyr::case_when(
seurat_score@meta.data$ratio > quantile(seurat_score@meta.data$ratio, 0.10) ~ "IFNG_RS",
seurat_score@meta.data$ratio < quantile(seurat_score@meta.data$ratio, 0.90) ~ "IFNG_GS",
TRUE ~ Malignant_clusters  # Keep other cell types unchanged
)
)
seurat_score@meta.data$response_ot <- paste(seurat_score@meta.data$Response, seurat_score@meta.data$Timepoint)
cell_type_proportions_all <- seurat_score@meta.data %>%
group_by(sample_ID, new_cell_type) %>%
plotly::summarise(Count = dplyr::n()) %>%
mutate(proportion = Count / sum(Count))
proportion_check <- cell_type_proportions_all %>%
group_by(sample_ID) %>%
dplyr::summarise(total_proportion = sum(proportion)) %>%
mutate(is_valid = dplyr::near(total_proportion, 1, tol = 1e-10))
# Aggregate metadata to retain unique sample-level information
seurat_aggregated <- seurat_score@meta.data %>%
group_by(sample_ID) %>%
summarise(across(everything(), first))  # Adjust the summarization logic as needed
prop_meta <- merge(cell_type_proportions_all, seurat_aggregated, by = "sample_ID",
all.x = T)
prop_meta_rs <- prop_meta[prop_meta$new_cell_type.x == "IFNG_RS",]
prop_meta_gs <- prop_meta[prop_meta$new_cell_type.x == "IFNG_GS",]
comp <- list(c("NonResponders BT", "NonResponders OT"),
c("Responders OT", "NonResponders OT"),
c("Responders BT", "NonResponders BT"),
c("Responders BT", "NonResponders OT"),
c("Responders BT", "Responders OT"))
# Example usage with proper parameters
p1 <- plot_boxplot(
prop_meta_rs,
x_var = "response_ot", # Must be quoted string
y_var = "proportion",
y_label = "Cell Population Proportions",
comparisons = comp,
color_pal = c("#4DBBD5FF","#4DBBD5FF","#E64B35FF","#E64B35FF"),
x_labels = c("NonResponders BT" = "NR BT", "NonResponders OT" = "NR OT",
"Responders BT" = "R BT", "Responders OT" = "R OT")
)  + ggtitle("Cells High IFNG.RS:IFNG.GS")
# Example usage with proper parameters
p2 <- plot_boxplot(
prop_meta_gs,
x_var = "response_ot", # Must be quoted string
y_var = "proportion",
y_label = "Cell Population Proportions",
comparisons = comp,
color_pal = c("#4DBBD5FF","#4DBBD5FF","#E64B35FF","#E64B35FF"),
x_labels = c("NonResponders BT" = "NR BT", "NonResponders OT" = "NR OT",
"Responders BT" = "R BT", "Responders OT" = "R OT")
) + ggtitle("Cells High IFNG_GS:IFNG.RS")
p1
seurat_score@meta.data <- seurat_score@meta.data %>%
mutate(
new_cell_type = dplyr::case_when(
seurat_score@meta.data$ratio > quantile(seurat_score@meta.data$ratio, 0.90) ~ "IFNG_RS",
seurat_score@meta.data$ratio < quantile(seurat_score@meta.data$ratio, 0.10) ~ "IFNG_GS",
TRUE ~ Malignant_clusters  # Keep other cell types unchanged
)
)
seurat_score@meta.data$response_ot <- paste(seurat_score@meta.data$Response, seurat_score@meta.data$Timepoint)
cell_type_proportions_all <- seurat_score@meta.data %>%
group_by(sample_ID, new_cell_type) %>%
plotly::summarise(Count = dplyr::n()) %>%
mutate(proportion = Count / sum(Count))
proportion_check <- cell_type_proportions_all %>%
group_by(sample_ID) %>%
dplyr::summarise(total_proportion = sum(proportion)) %>%
mutate(is_valid = dplyr::near(total_proportion, 1, tol = 1e-10))
# Aggregate metadata to retain unique sample-level information
seurat_aggregated <- seurat_score@meta.data %>%
group_by(sample_ID) %>%
summarise(across(everything(), first))  # Adjust the summarization logic as needed
prop_meta <- merge(cell_type_proportions_all, seurat_aggregated, by = "sample_ID",
all.x = T)
prop_meta_rs <- prop_meta[prop_meta$new_cell_type.x == "IFNG_RS",]
prop_meta_gs <- prop_meta[prop_meta$new_cell_type.x == "IFNG_GS",]
comp <- list(c("NonResponders BT", "NonResponders OT"),
c("Responders OT", "NonResponders OT"),
c("Responders BT", "NonResponders BT"),
c("Responders BT", "NonResponders OT"),
c("Responders BT", "Responders OT"))
# Example usage with proper parameters
p1 <- plot_boxplot(
prop_meta_rs,
x_var = "response_ot", # Must be quoted string
y_var = "proportion",
y_label = "Cell Population Proportions",
comparisons = comp,
color_pal = c("#4DBBD5FF","#4DBBD5FF","#E64B35FF","#E64B35FF"),
x_labels = c("NonResponders BT" = "NR BT", "NonResponders OT" = "NR OT",
"Responders BT" = "R BT", "Responders OT" = "R OT")
)  + ggtitle("Cells High IFNG.RS:IFNG.GS")
# Example usage with proper parameters
p2 <- plot_boxplot(
prop_meta_gs,
x_var = "response_ot", # Must be quoted string
y_var = "proportion",
y_label = "Cell Population Proportions",
comparisons = comp,
color_pal = c("#4DBBD5FF","#4DBBD5FF","#E64B35FF","#E64B35FF"),
